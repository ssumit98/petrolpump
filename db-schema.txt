
# Firestore Database Schema

## Collections

### users
Document ID: `uid` (from Firebase Auth)
- email: string
- role: string ("Owner" | "Manager" | "PumpAttendant" | "Customer")
- createdAt: timestamp (ISO string)

### prices
Document ID: `fuelType` (e.g., "petrol", "diesel", "power")
- rate: number
- updatedAt: timestamp (ISO string)

### employees
Document ID: Auto-generated
- name: string
- role: string
- status: string ("Active" | "On Leave" | "Inactive")
- shortage: number (Total cash shortage amount)

### tanks
Document ID: `tankId` (e.g., "tank1", "tank2")
- fuelType: string ("Petrol" | "Diesel")
- capacity: number (Total capacity in Litres)
- currentLevel: number (Current volume in Litres)
- currentDip: number (Dip reading in mm/cm)
- density: number (Fuel density)
- updatedAt: timestamp (ISO string)

### nozzles
Document ID: `nozzleId`
- nozzleName: string (e.g., "Nozzle 1 - Petrol")
- linkedTankId: string (Reference to `tanks` document ID)
- currentMeterReading: number (Last recorded meter reading)

### daily_sales
Document ID: Auto-generated
- date: string (YYYY-MM-DD)
- attendantId: string (Reference to `users` or `employees` ID)
- nozzleId: string (Reference to `nozzles` ID)
- startReading: number
- endReading: number
- totalLitres: number (endReading - startReading)
- totalCash: number
- shiftId: string (e.g., "Morning", "Evening", or specific ID)
- timestamp: timestamp

### credit_transactions
Document ID: Auto-generated
- customerId: string (Reference to `customers` ID)
- vehicleNumber: string
- amount: number
- date: timestamp (ISO string)
- status: string ("Pending" | "Paid")

### customers
Document ID: Auto-generated
- name: string
- phone: string
- creditLimit: number
- outstandingBalance: number

--------------------------------------------------
FIREBASE SECURITY RULES (Copy and Paste into Firestore Rules Tab)
--------------------------------------------------
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // Helper to get user data
    function getUserData() {
      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data;
    }
    
    // Helper to check if user is Owner
    function isOwner() {
      return isAuthenticated() && getUserData().role == 'Owner';
    }

    // Helper to check if user is Manager
    function isManager() {
      return isAuthenticated() && (getUserData().role == 'Manager' || getUserData().role == 'Owner');
    }

    // USERS Collection
    // Users can read/write their own document. Owners can read all.
    match /users/{userId} {
      allow read, write: if isAuthenticated() && (request.auth.uid == userId || isOwner());
    }

    // DEFAULT RULE for all other collections
    // Allow read/write if user is authenticated. 
    // This blocks public unauthenticated access but allows your app to function.
    match /{document=**} {
      allow read, write: if isAuthenticated();
    }
  }
}

--------------------------------------------------
IMPORTANT NOTE ON DOMAIN RESTRICTION:
Firestore Security Rules run on the server and CANNOT restrict access by Domain (e.g., localhost, vercel.app). 
To restrict usage to specific domains:
1. Go to Firebase Console -> Authentication -> Settings -> Authorized Domains.
2. Add 'petrolpump-green.vercel.app' and 'localhost'.
3. Remove 'localhost' if you want to block local development in production (not recommended for dev).
4. CONSIDER 'App Check' for stricter enforcement if needed.
